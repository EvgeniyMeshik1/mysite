!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).normaliz={})}(this,(function(e){"use strict";const n=e=>e.reduce(((e,n)=>(n instanceof Array?n[1]instanceof Array?e[n[0]]=[n[1],n[2]]:e[n[0]]=[[],n[1]]:e[n]=[[]],e)),{});e.denormaliz=function e(r,{entities:t,schema:i,options:o={}}={},a={}){if(!r)return r;if(!(i instanceof Array))throw new Error("Invalid schema - expecting an array. Got: "+i);return Object.entries(n(i)).forEach((([n,[i,o={}]])=>{let a=r[n];if(!a)return;const s=o.mapping||n,f=!1===o.normalize,c=n=>e(n,{entities:t,schema:i,options:o});r[n]=Array.isArray(a)?r[n].map((e=>c(f?e:t[s][e]))):c(f?a:t[s][a])})),JSON.parse(JSON.stringify(r))},e.normaliz=function e(r,{entity:t,from:i,schema:o,options:a={}}={},s={},f=!0){if(!r)return r;if(f&&(r=JSON.parse(JSON.stringify(r))),!(o instanceof Array))throw new Error("Invalid schema - expecting an array. Got: "+o);if("string"!=typeof t)throw new Error("Invalid entity - expecting a string. Got: "+t);const c=Array.isArray(r);c||(r=[r]);const y=a.mapping||t;return s=r.reduce(((r,t)=>{const s=a.key?"function"==typeof a.key?a.key(t):t[a.key]:t.id;return Object.entries(n(o)).forEach((([n,[i,o={}]])=>{let a=t[n];if(!a)return;let s=o.key||"id";r=e(a,{entity:n,schema:i,options:o},r,!1),!1!==o.normalize?Array.isArray(a)?t[n]=a.map((e=>"function"==typeof s?s(e):e[s])):t[n]="function"==typeof s?s(a):a[s]:t[n]=a})),!1!==a.normalize&&(r[y]||(r[y]={}),r[y][s]=t,i&&Object.entries(i).forEach((([e,n])=>{r[e]||(r[e]={}),r[e][n]||(r[e][n]={}),c?(r[e][n][y]||(r[e][n][y]=[]),r[e][n][y].push(s)):r[e][n][y]=s}))),r}),s)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
